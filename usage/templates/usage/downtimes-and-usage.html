{% extends "admin/base_site.html" %} {% load i18n admin_static %} {% load cms_tags staticfiles compressed %} {% block title %} Allocation Administration | Chameleon Cloud {% endblock %}
<!-- Custom CSS -->
{% block extrastyle %}{{ block.super }} {% compressed_css 'main' %}
<link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600' rel='stylesheet' type='text/css'>
<link rel="stylesheet" type="text/css" href="{% static 'admin/css/dashboard.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'djangocms_admin_style/css/djangocms-admin.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'usage/css/main.css' %}"> {% endblock %} {% block extrahead %} {% compressed_js 'all' %}
<!--<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
<script src="http://code.highcharts.com/stock/highstock.js"></script>
<script src="http://code.highcharts.com/modules/exporting.js"></script>-->
<script src="{% static 'usage/js/vendor.js' %}"></script>
<script src="{% static 'usage/js/main.js' %}"></script>
{% endblock %} {% block coltype %}colM{% endblock %} {% block bodyclass %}{{ block.super }} change-form{% endblock %} {% if not is_popup %} {% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">{% trans 'Home' %}</a> &rsaquo; {% trans 'Manage Allocations' %}
</div>
{% endblock %} {% endif %} {% block content %}
<div class="usage-app">
    <h1>Downtimes and Usage</h1>
    <div id="content-main" ng-app="usageApp" ng-cloak>
        <div class="content" ng-controller="UsageController">
            <table>
                <tr>
                    <td class="name"><strong>Queue:</strong></td>
                    <td>
                        <select ng-model="downtimes.selectedQueue" ng-change="updateDowntimesUsageChart()">
                            <option value="">-- All queues --</option>
                            <option value="kvm@tacc">KVM@TACC</option>
                            <option value="kvm@uc">KVM@UC</option>
                            <option value="chi@tacc">CHI@TACC</option>
                            <option value="chi@uc">CHI@UC</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td class="name"><strong>From:</strong></td>
                    <td>
                        <input type="text" id="startDate" name="startDate" datepicker-popup="[[format]]" ng-model="downtimes.from" is-open="downtimes.startOpened" min-date="getMinDowntimeDate()" max-date="getMaxDowntimeDate()" datepicker-options="dateOptions" date-disabled="disabled(date, mode)" ng-required="true" ng-disabled="true" close-text="Close" />
                        <button type="button" class="btn btn-default" ng-click="isOpen4Downtimes($event, 'start')"><i class="fa fa-calendar"></i>
                        </button>
                    </td>
                </tr>
                <tr>
                    <td class="name"><strong>To:</strong></td>
                    <td>
                        <input type="text" id="endDate" name="endDate" datepicker-popup="[[format]]" ng-model="downtimes.to" is-open="downtimes.endOpened" min-date="downtimes.from" max-date="getMaxDowntimeDate()" datepicker-options="dateOptions" date-disabled="disabled(date, mode)" ng-required="true" ng-disabled="true" close-text="Close" />
                        <button type="button" class="btn btn-default" ng-click="isOpen4Downtimes($event, 'end')"><i class="fa fa-calendar"></i>
                        </button>
                    </td>
                </tr>
                <tr>
                    <td>&nbsp;</td>
                    <td>
                        <button type="button" class="btn btn-default" ng-click="updateDowntimesUsageChart('custom')">
                            Reload chart
                        </button>
                    </td>
                </tr>
                <tr>
                    <td colspan=2>
                        <button type="button" class="btn btn-sm btn-default" ng-click="updateDowntimesUsageChart('1m')" ng-disabled="downtimes.dateRange === '1m'">
                            1m
                        </button>
                        <button type="button" class="btn btn-sm btn-default" ng-click="updateDowntimesUsageChart('3m')" ng-disabled="downtimes.dateRange === '3m'">
                            3m
                        </button>
                        <button type="button" class="btn btn-sm btn-default" ng-click="updateDowntimesUsageChart('6m')" ng-disabled="downtimes.dateRange === '6m'">
                            6m
                        </button>
                        <button type="button" class="btn btn-sm btn-default" ng-click="updateDowntimesUsageChart('ytd')" ng-disabled="downtimes.dateRange === 'ytd'">
                            YTD
                        </button>
                        <button type="button" class="btn btn-sm btn-default" ng-click="updateDowntimesUsageChart('1y')" ng-disabled="downtimes.dateRange === '1y'">
                            1y
                        </button>
                        <button type="button" class="btn btn-sm btn-default" ng-click="updateDowntimesUsageChart('all')" ng-disabled="downtimes.dateRange === 'all'">
                            All
                        </button>
                    </td>
                </tr>
            </table>
            <br/>
            <div class="well" ng-if="loading.downtimes">
                <span class="fa fa-spinner fa-spin"></span> Loading downtimes usage chart...
            </div>
            <div ng-if="!loading.downtimes">
                <div ng-if="isEmpty(messages.downtimes)">
                    <div ng-if="downtimes.data.length === 0">
                        <alert type="warning">Downtimes and usage not found.</alert>
                    </div>
                    <div ng-if="downtimes.data.length > 0" class="form-group module">
                        <highchart id="downtimes-usage-chart" config="project.usageByUserChartConfig" ng-if="isEmpty(messages.downtimes)"></highchart>
                    </div>
                </div>
                <div ng-if="!isEmpty(messages.downtimes)">
                    <alert ng-repeat="msg in messages.downtimes" type="[[msg.type]]">[[msg.body]]</alert>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
