# mysite_nginx.conf

# the upstream component nginx needs to connect to
upstream django {
  server unix:///tmp/chameleon-app.sock; # for a file socket
  # server 127.0.0.1:8001; # for a web port socket (we'll use this first)
}

server {
  listen         80 default_server;
  server_name    www.chameleoncloud.org chameleoncloud.org www.chameleon.tacc.utexas.edu;
  return         301 https://$server_name$request_uri;
}

server {
  listen      443 ssl;

  server_name    www.chameleoncloud.org chameleoncloud.org www.chameleon.tacc.utexas.edu;
  charset     utf-8;

  ssl_certificate     /etc/ssl/chameleoncloud.org/bundle.crt;
  ssl_certificate_key /etc/ssl/chameleoncloud.org/site.key;

  # max upload size
  client_max_body_size 75M;   # adjust to taste

  # Django media
  location /media  {
    alias /project/media;  # your Django project's media files - amend as required
  }

  location /static {
    alias /var/www/static; # your Django project's static files - amend as required
  }

  # Finally, send all non-media requests to the Django server.
  location / {
    uwsgi_pass  django;
    include     /project/docker-conf/uwsgi_params; # the uwsgi_params file you installed
  }
}
