"use strict";angular.module("underscore",[]).factory("_",function(){return window._}),angular.module("moment",[]).factory("moment",function(){return window.moment}),angular.module("appCatalogApp.service",[]),angular.module("appCatalogApp",["underscore","moment","appCatalogApp.service","ui.bootstrap","toggle-switch","angularjs-dropdown-multiselect","truncate"]).config(["$interpolateProvider","$httpProvider",function(a,b){a.startSymbol("[[").endSymbol("]]"),b.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",b.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",b.defaults.xsrfCookieName="csrftoken",b.defaults.xsrfHeaderName="X-CSRFToken"}]),angular.module("appCatalogApp.service").factory("NotificationFactory",["$rootScope","$timeout","_",function(a,b,c){var d={},e={},f={};return d.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})},d.addLoading=function(b){f[b]=!0,a.$broadcast("appliance:notifyLoading")},d.removeLoading=function(b){delete f[b],a.$broadcast("appliance:notifyLoading")},d.getMessages=function(){return e},d.getLoading=function(){return f},d.clearMessages=function(b){b=b||"all","all"===b?e={}:e[b]=[],a.$broadcast("appliance:notifyMessage")},d.removeMessage=function(b,d,f){"undefined"!=typeof f&&(b+=f);var g=e[b];!g||g.length<1||(e[b]=c.reject(g,function(a){return a._id===d._id}),a.$broadcast("appliance:notifyMessage"))},d.addMessage=function(c,f,g){var h={};h.body=f,h.type=g,h._id=d.uuid(),"undefined"==typeof e[c]&&(e[c]=[]),e[c].push(h),a.$broadcast("appliance:notifyMessage");var i="danger"===h.type?0:5e3;i>0&&b(function(){d.removeMessage(c,h)},i)},d}]).factory("UtilFactory",["_","moment","NotificationFactory",function(a,b,c){var d={};return d.getClass=function(a){var b=a.status.toLowerCase();return"pending"===b?"label label-warning":"rejected"===b?"label label-danger":"label label-success"},d.isLoading=function(a,b){if(!a||!b)return!1;var d=a+b.id;return"undefined"==typeof c.getLoading()[d]?!1:!0},d.closeMessage=function(a,b,d){d="undefined"==typeof d||null===d?"":d,a+=d,c.removeMessage(a,b)},d.isEmpty=function(b){return"undefined"!=typeof b&&b?angular.isArray(b)&&0===b.length?!0:angular.isObject(b)&&a.isEmpty(b)?!0:!1:!0},d.hasMessage=function(a,b){var c=!1;if("undefined"==typeof a||null===a||a===[]||"undefined"==typeof b||null===b||""===b)return c;for(var d in a)if(a[d].type===b){c=!0;break}return c},d.getMessages=function(a,b){if(!a||!b)return[];var d=a+b.id,e=c.getMessages()[d];return"undefined"!=typeof e&&e.length>0?e:[]},d.search=function(b,c){return c?a.filter(b,function(a){c=c.toLowerCase();var b=!1,d=a.name||"",e=a.description||"",f=a.author_name||"";return d.toLowerCase().indexOf(c)>-1?b=!0:e.toLowerCase().indexOf(c)>-1?b=!0:f.toLowerCase().indexOf(c)>-1&&(b=!0),b}):angular.copy(b)},d}]).factory("ApplianceFactory",["$http","_","moment","NotificationFactory",function(a,b,c,d){var e={};return e.appliances=[],e.appliance=null,e.keywords=[],e.getAppliances=function(b){var c="/appliance-catalog/api/appliances/";if(b){c+="?";for(var f in b)c+="keywords="+b[f].id,f<b.length-1&&(c+="&")}var g="There was an error loading appliance catalog.";return d.clearMessages("appCatalog"),d.addLoading("appCatalog"),a({method:"GET",url:c,cache:"true"}).then(function(a){d.removeLoading("appCatalog"),e.appliances=a.data.result},function(){d.addMessage("appCatalog",g,"danger"),d.removeLoading("appCatalog")})},e.getKeywords=function(){var b="There was an error loading keywords.";return d.clearMessages("keywords"),d.addLoading("keywords"),a({method:"GET",url:"/appliance-catalog/api/keywords/",cache:"true"}).then(function(a){d.removeLoading("keywords");var b=a.data.result;for(var c in b)e.keywords.push({id:b[c].id,label:b[c].id})},function(){d.addMessage("keywords",b,"danger"),d.removeLoading("keywords")})},e.getAppliance=function(b){var c="There was an error loading this appliance.";return d.clearMessages("appliance"),d.addLoading("appliance"),a({method:"GET",url:"/appliance-catalog/api/appliances/"+b+"/",cache:"true"}).then(function(a){d.removeLoading("appliance"),e.appliances=a.data},function(){d.addMessage("appliance",c,"danger"),d.removeLoading("appliance")})},e}]),angular.module("appCatalogApp").controller("AppCatalogController",["$scope","$http","$timeout","moment","_","UtilFactory","ApplianceFactory","NotificationFactory",function(a,b,c,d,e,f,g,h){a.messages=[],a.$on("appliance:notifyMessage",function(){a.messages=h.getMessages()}),a.loading={},a.$on("appliance:notifyLoading",function(){a.loading=h.getLoading()}),a.close=f.closeMessage,a.isEmpty=f.isEmpty,a.hasMessage=f.hasMessage,a.isLoading=f.isLoading,a.getMessages=f.getMessages,a.getClass=f.getClass,a.filterInit=function(){a.filter={selectedKeywords:[],searchKey:"",andSearch:!0}},a.filterInit(),a.reset=function(){a.filterInit(),a.filteredAppliances=angular.copy(a.appliances),i()};var i=function(){a.appsPerPage=15,a.totalPages=Math.ceil(a.filteredAppliances.length/a.appsPerPage),a.appsCurrentPage=1,a.appsPageChanged(a.appsCurrentPage)};a.appsPageChanged=function(b){var c=(b-1)*a.appsPerPage,d=c+a.appsPerPage;d>a.filteredAppliances.length-1&&(d=a.filteredAppliances.length),a.appsThisPage=a.filteredAppliances.slice(c,d)},a.appliances=[],a.filteredAppliances=[],a.getAppliances=function(){g.getAppliances().then(function(){a.appliances=angular.copy(g.appliances),a.filteredAppliances=angular.copy(g.appliances),i()})},a.getAppliances(),a.getKeywords=function(){a.keywords=[],g.getKeywords().then(function(){a.keywords=g.keywords})},a.getKeywords(),a.getPageIndex=function(){var b=(a.appsCurrentPage-1)*a.appsPerPage+1,c=a.appsCurrentPage*a.appsPerPage<a.filteredAppliances.length?a.appsCurrentPage*a.appsPerPage:a.filteredAppliances.length;return b+"-"+c},a.multiselectSettings={smartButtonMaxItems:15,scrollableHeight:"400px",scrollable:!0,enableSearch:!0,smartButtonTextConverter:function(a){return a.length>20?a.substring(0,17)+"...":a}},a.multiselectCustomTexts={buttonDefaultText:"Search by keywords"},a.updateFiltered=function(){a.filter.selectedKeywords?g.getAppliances(a.filter.selectedKeywords).then(function(){a.filter.andSearch?a.filteredAppliances=f.search(g.appliances,a.filter.searchKey):a.filteredAppliances=e.union(f.search(a.appliances,a.filter.searchKey),g.appliances),i()}):(a.filteredAppliances=f.search(a.filteredAppliances,a.filter.searchKey),i())}}]);