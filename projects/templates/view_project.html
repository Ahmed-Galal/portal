{% extends 'layout/user.html' %}

{% load staticfiles %}

{% load bootstrap3 %}

{% block title %}Project - {{ project.chargeCode }}{% endblock %}

{% block content %}
<h2>
  {{ project.title }} |
  <small>{{ project.chargeCode }}</small>
</h2>

<div class="table-responsive">
  <table class="table">
    <tbody>
      <tr>
        <th>PI</th>
        <td>
          {{ project.pi.firstName }} {{ project.pi.lastName }} <a href="mailto:{{ project.pi.email }}">&lt;{{ project.pi.email }}&gt;</a>,
          {{ project.pi.institution}}
        </td>
      </tr>
      <tr>
        <th>Abstract</th>
        <td>{{ project.description }}</td>
      </tr>
      <tr>
        <th>Type</th>
        <td>{{ project.type }}</td>
      </tr>
      <tr>
        <th>Field of Science</th>
        <td>{{ project.field }}</td>
      </tr>
      <tr>
        <th>Allocation</th>
        <td>
          <ul class="list-unstyled">
            {% for alloc in project.allocations %}
              <li>{{ alloc.resource }} <i>{{ alloc.status }}</i></li>
            {% endfor %}
          </ul>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<h3>Project Users</h3>

{% if is_pi %}
<form class="form-inline" role="form" method="post">
  {% csrf_token %}
  {% bootstrap_form form %}
  <div class="form-group">
    <button type="submit" class="btn btn-default" name="add_user">Add user</button>
  </div>
</form>
{% endif %}

<div class="row">
  <div class="col-md-6">
    <h4>Current Users</h4>
    <ul class="list-unstyled">
      {% for u in users %}
      <li>
        {{ u.username }} ({{ u.role }})
        {% if is_pi and u.username != request.user.username %}
          <form role="form" method="post" style="display:inline">
            {% csrf_token %}
            <input type="hidden" name="username" value="{{ u.username }}">
            <button type="submit" class="btn btn-xs btn-link" name="del_user"><i class="fa fa-minus-square text-danger"></i><span class="sr-only">Remove user</span></button>
          </form>
        {% endif %}
      </li>
      {% endfor %}
    </ul>
  </div>

  {% if fg_migration %}
  <input type="hidden" name="fg_add_user_url" value="{% url 'projects.views.fg_add_user' project.id %}">
  <div class="col-md-6">
    <div class="well">
      <h4>Add/Invite FutureGrid Users</h4>
      <table class="table">
        <tbody>
        {% for u in fg_users %}
          <tr>
            <td width="30%">{{ u.username }}</td>
            <td>
              <form role="form" name="fg-user-add">
                {% csrf_token %}
                <input type="hidden" name="username" value="{{ u.username }}">
                <input type="hidden" name="email" value="{{ u.email }}">
                <button type="submit" class="btn btn-default btn-sm"><i class="fa fa-plus-circle"></i> Add User</button>
              </form>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  {% endif %}
</div>

{% endblock %}

{% block scripts %}
  <script src="{% static 'projects/js/fg_user_add.js' %}" type="text/javascript"></script>
{% endblock %}
