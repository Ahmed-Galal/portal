{% extends 'layout/user.html' %}
{% load staticfiles bootstrap3 chameleon_tags %}
{% block title %}Project - {{ project.chargeCode }}{% endblock %}
{% block content %}
<h2>
  {{ project.title }} |
  <small>{{ project.chargeCode }}</small>
</h2>

<div class="table-responsive">
  <table class="table">
    <tbody>
      <tr>
        <th>PI</th>
        <td>
          {{ project.pi.firstName }} {{ project.pi.lastName }} <a href="mailto:{{ project.pi.email }}">&lt;{{ project.pi.email }}&gt;</a>,
          {{ project.pi.institution}}
        </td>
      </tr>
      <tr>
        <th>Abstract</th>
        <td style="white-space:pre-wrap;">{{ project.description }}</td>
      </tr>
      <tr>
        <th>Type</th>
        <td>{{ project.type }}</td>
      </tr>
      <tr>
        <th>Field of Science</th>
        <td>{{ project.field }}</td>
      </tr>
    </tbody>
  </table>
</div>

<h3>Allocations</h3>
<div class="allocations">
  {% if project.has_active_allocations %}
    {% for alloc in project.allocations %}
      {% include 'projects/allocation.html' %}
    {% endfor %}
  {% else %}
          You don't seem to have any active allocations! This could be because your allocation expired, or your project is new and you have not requested one yet.
          Please click on the "Request Allocation" link below to get started!
          <br /><br/>
          <a class="btn btn-default btn-sm" href="{% url 'projects:create_allocation' project.id %}">
            <i class="fa fa-plus"></i>
            Request Allocation
          </a>
  {% endif %}
</div>

<h3>Project Users</h3>

{% if is_pi %}
<form class="form-inline" role="form" method="post">
  {% csrf_token %}
  {% bootstrap_form form %}
  <div class="form-group">
    <button type="submit" class="btn btn-default" name="add_user">Add user</button>
  </div>
</form>
{% endif %}

<div class="row">
  <div class="col-md-6">
    <h4>Current Users</h4>
    <ul class="list-unstyled">
      {% for u in users %}
      <li>
        {{ u.username }} ({{ u.role }})
        {% if is_pi and u.username != request.user.username %}
          <form role="form" method="post" style="display:inline">
            {% csrf_token %}
            <input type="hidden" name="username" value="{{ u.username }}">
            <button type="submit" class="btn btn-xs btn-link" name="del_user"><i class="fa fa-minus-square text-danger"></i><span class="sr-only">Remove user</span></button>
          </form>
        {% endif %}
      </li>
      {% endfor %}
    </ul>
  </div>

  {% if fg_migration and is_pi %}
  <input type="hidden" name="fg_add_user_url" value="{% url 'projects:fg_add_user' project.id %}">
  <div class="col-md-6">
    <div class="well">
      <h4>Add/Invite FutureGrid Users</h4>
      <table class="table">
        <tbody>
        {% for u in fg_users %}
          <tr>
            <td width="30%">{{ u.username }}</td>
            <td>
              <form role="form" name="fg-user-add">
                {% csrf_token %}
                <input type="hidden" name="username" value="{{ u.username }}">
                <input type="hidden" name="email" value="{{ u.email }}">
                <button type="submit" class="btn btn-default btn-sm"><i class="fa fa-plus-circle"></i> Add User</button>
              </form>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}

{% block scripts %}
  <script src="{% static 'bower_components/jquery-ui/ui/core.js' %}" type="text/javascript"></script>
  <script src="{% static 'bower_components/jquery-ui/ui/widget.js' %}" type="text/javascript"></script>
  <script src="{% static 'bower_components/jquery-ui/ui/progressbar.js' %}" type="text/javascript"></script>
  <script src="{% static 'projects/js/fg_user_add.js' %}" type="text/javascript"></script>
  <script src="{% static 'projects/js/allocations.js' %}" type="text/javascript"></script>
{% endblock %}
